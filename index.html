<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>File Upload Form</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row">
        <div class="col-md-6 mx-auto">
          <div
            id="dropzone"
            class="border rounded p-1"
            ondragover="handleDragOver(event);"
            ondrop="handleFileSelect(event);"
          >
            <p class="text-center">
              Drag and drop a file here to upload
              <span id="fileStatus" class="ml-2 text-success">&#x274C;</span>
            </p>
            <div class="text-center">
              <label for="fileInput" class="btn btn-primary">
                or Select a file</label
              >
              <input
                type="file"
                id="fileInput"
                onchange="handleFileSelect(event);"
                style="display: none"
              />
              <small class="form-text text-muted"
                >md5-hash:
                <span id="md5"></span>
              </small>
            </div>
          </div>
          <div class="form-group mt-4">
            <label for="values">Values:</label>
            <textarea
              class="form-control"
              id="values"
              name="values"
              rows="5"
            ></textarea>
          </div>
          <pre><div id="file-content"></div></pre>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.min.js"></script>

    <script>
      var originalFileContent;
      var newFileContent;
      var md5Hash;
      var md5FileHash;
      var values;

      function handleFileSelect(event) {
        event.stopPropagation();
        event.preventDefault();
        var files = event.target.files || event.dataTransfer.files;
        if (files.length > 0) {
          var file = files[0];
          var reader = new FileReader();
          reader.onload = function (event) {
            var originalFileContent = event.target.result;
            document.getElementById("file-content").innerHTML =
              originalFileContent;
            document.getElementById("fileStatus").innerHTML = "&#x2714;";

            md5FileHash = CryptoJS.MD5(originalFileContent).toString();
            document.getElementById("md5").innerHTML = md5FileHash;

            newFileContent = originalFileContent;
          };
          reader.readAsText(file);
        }
      }

      function handleDragOver(event) {
        event.preventDefault();
      }

      function readFile(file) {
        var reader = new FileReader();
        reader.onload = function (event) {
          originalFileContent = event.target.result;
          displayoriginalFileContent();
        };
        reader.readAsText(file);
      }

      function displayoriginalFileContent() {
        var contentDiv = document.getElementById("uploadedContent");
        var pre = document.createElement("pre");
        pre.textContent = newFileContent;
        contentDiv.appendChild(pre);
      }

      function checkLinesForHexPairs(str) {
        newFileContent = originalFileContent;

        const lines = str.split(/\r?\n/); // Split string into array of lines
        const hexPairRegex = /^[0-9a-fA-F](?:[,:;-])[0-9a-fA-F]{2}$/; // Regex for hex pairs separated by comma
        console.log("---");
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].replace(/\s/g, ""); // Remove all whitespace from line

          if (hexPairRegex.test(line)) {
            // change here the character in newFileContent and display change
            console.log(`Line ${i + 1} contains a valid hex pair: ${line}`);
          }
        }
      }

      document.getElementById("values").oninput = () => {
        checkLinesForHexPairs(document.getElementById("values").value);

        console.log(document.getElementById("values").value); // Do something
      };
    </script>
  </body>
</html>
